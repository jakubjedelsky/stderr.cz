<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Útočí na mě z... @ stderr</title>

        <meta charset="UTF-8">

		<link rel="shortcut icon" href="favicon.ico" />

        <link href="http://stderr.cz/theme/css/bootstrap.min.css" rel="stylesheet">
        <link href="http://stderr.cz/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="http://stderr.cz/theme/css/pygment.css" rel="stylesheet">
        <link href="http://stderr.cz/theme/css/mystyle.css" rel="stylesheet">
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,700,300&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <meta name="twitter:card" value="summary" />
    <meta name="twitter:creator" content="@kubiis" />
    <meta name="twitter:title" content="Útočí na mě z..." />
    <meta name="twitter:description" content="Čas Vánoční je čas pohody, klidu a míru. To platí jen do určité chvíle. Třeba dokud na váš server nezačnou útočit z ... Číny. Jedná se o celkem aktuální aférku, o které se (pěkně blbě, takže to ani ..." />

        <link rel="alternate" type="application/atom+xml" href="http://stderr.cz/feed.atom.xml" title="stderr ATOM/RSS Feed" />
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-44139591-1', 'auto');
            ga('send', 'pageview');
        </script>
    </head>

    <body>
    <div class="container">
        <div class="row">
            <div class="span8 offset3">
                <ul class="breadcrumb menu">
                    <li><a href="http://stderr.cz/o-autorovi">O autorovi</a></li>
                    <li><a href="http://stderr.cz/archives">Archiv</a></li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="span3 text-right">
                <div class="hero-unit">
                    <h1><a href="http://stderr.cz">stderr</a></h1>
                    <p>2>&1</p>
                </div>
                <div class="metadata">
                    <ul class="social">
                            <li><a href="https://twitter.com/kubiis" target="_blank"><img src="http://stderr.cz/theme/social/twitter-32.png" title="Twitter" class="si-twitter" /></a></li>
                            <li><a href="https://github.com/jakubjedelsky" target="_blank"><img src="http://stderr.cz/theme/social/github-32.png" title="Github" class="si-github" /></a></li>
                            <li><a href="http://www.linkedin.com/in/jedelsky" target="_blank"><img src="http://stderr.cz/theme/social/linkedin-32.png" title="Linkedin" class="si-linkedin" /></a></li>
                            <li><a href="http://stderr.cz/feed.atom.xml" target="_blank"><img src="http://stderr.cz/theme/social/rss-32.png" title="Rss" class="si-rss" /></a></li>
                    </ul>
                </div>
            </div>
            <div class="span8">
<h2>Útočí na mě z...</h2>
<time datetime=2011-12-19T16:00:00+01:00>19. 12. 2011</time><div class="flattr">
    <script id='flattrbtn'>
    (function(i) {
        var f,s=document.getElementById(i);
        f=document.createElement('iframe');
        f.src='//api.flattr.com/button/view/?uid=stderr&button=compact&url='+encodeURIComponent(document.URL)+'&title=Útočí na mě z...';
        f.title='Flattr';
        f.height=20;
        f.width=110;
        f.style.borderWidth=0;
        s.parentNode.insertBefore(f,s);
        })
    ('flattrbtn');
    </script>
</div>
<div class="article">
<p>Čas Vánoční je čas pohody, klidu a míru. To platí jen do určité chvíle.
Třeba dokud na váš server nezačnou útočit z ... Číny.</p>
<p>Jedná se o celkem aktuální aférku, o které se (pěkně blbě, takže to ani
nečtěte) rozepsala <a href="http://www.lupa.cz/clanky/tisice-tuzemskych-e-shopu-melo-vypadky-muze-za-to-masivni-ddos-utok/">Lupa.cz</a>, nějaké detaily o probíhajících útocích
jsou na <a href="http://www.rcnoviny.cz/2011/12/ddos-tok-na-strnky-s-rc-modely/">rcnoviny.cz</a>.  </p>
<p>Ochrana proti takovému DDOS útoku není žádná sranda a jako admin
serveru máte jen omezené pole působnosti. Dokud útočníci nezahltí linku
(pak to řešte se svým ISP) a data k vám tak ještě putují, máte jen pár
možností, jak se těch nevyžádaných zbavit:</p>
<ul>
<li>
<p><strong>Omezení počtu současných připojení:</strong> je elegantní řešení. Pokud
    je ale botnet velký, stačí útočníkovi pouze omezený počet spojení a
    stejně vás položí. Naopak můžete omezit uživatele, kteří jsou za
    velkým NATem. Zkusit to ale preventivně můžete:</p>
<div class="highlight"><pre><span class="cp"># zablokování portu 80 (webserver) nad 20 současných připojení</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="n">INPUT</span> <span class="o">-</span><span class="n">p</span> <span class="n">TCP</span> <span class="o">--</span><span class="n">syn</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">80</span> <span class="o">-</span><span class="n">m</span> <span class="n">connlimit</span> <span class="o">--</span><span class="n">connlimit</span><span class="o">-</span><span class="n">above</span> <span class="mi">20</span> <span class="o">-</span><span class="n">j</span> <span class="n">REJECT</span>
</pre></div>


</li>
<li>
<p><strong>Omezení připojení za časový úsek:</strong> má podobné omezení, jako výše
    uvedené.</p>
<div class="highlight"><pre><span class="cp"># zablokování nových TCP spojení</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="n">INPUT</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">syn</span> <span class="o">-</span><span class="n">m</span> <span class="n">limit</span> <span class="o">--</span><span class="n">limit</span> <span class="mi">1</span><span class="o">/</span><span class="n">s</span> <span class="o">--</span><span class="n">limit</span><span class="o">-</span><span class="n">burst</span> <span class="mi">3</span> <span class="o">-</span><span class="n">j</span> <span class="n">RETURN</span>
</pre></div>


</li>
<li>
<p><strong>Omezení přístupu z konkrétní země:</strong> je dobré v případě, že na
    server útočí právě botnet, který je jen (nebo alespoň z podstatné
    části) v jedné konkrétní zemi a zároveň máte to štěstí, že s ní
    nemusíte komunikovat. Veškeré subnety rozdělené podle zemí najdete
    na webu <a href="http://www.ipdeny.com/ipblocks/">ipdeny.com</a>. Pro omezení příchozích spojení z Číny proto
    provedeme:</p>
<div class="highlight"><pre><span class="n">wget</span> <span class="n">http</span><span class="o">:</span><span class="c1">//www.ipdeny.com/ipblocks/data/countries/cn.zone</span>
<span class="k">while</span> <span class="n">read</span> <span class="n">SUBNET</span> <span class="p">;</span> <span class="k">do</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="n">INPUT</span> <span class="o">-</span><span class="n">s</span> <span class="err">$</span><span class="n">SUBNET</span> <span class="o">-</span><span class="n">j</span> <span class="n">REJECT</span> <span class="p">;</span> <span class="n">done</span> <span class="o">&lt;</span> <span class="n">cn</span><span class="p">.</span><span class="n">zone</span>
</pre></div>


</li>
</ul>
<p>Žádné z výše popsaných řešení není úplně nejlepší, ale může pomoci při
první obraně systému. Další bezpečnostní otázky řešte s dokumentací
systému, manuálem k <code>iptables</code> a v neposlední řadě se svým ISP, který za
tučnou úplatu určitě rád pomůže.</p>
<p>Máte nějaké další tipy, jak útokům předejít? Podělte se..</p>
<p><strong>Zajímavé zdroje:</strong></p>
<ul>
<li><a href="http://cs.wikipedia.org/wiki/Botnet">http://cs.wikipedia.org/wiki/Botnet</a></li>
<li><a href="http://www.ipdeny.com/ipblocks">http://www.ipdeny.com/ipblocks</a></li>
<li><a href="http://www.cyberciti.biz/faq/iptables-connection-limits-howto/">http://www.cyberciti.biz/faq/iptables-connection-limits-howto/</a></li>
<li><a href="http://www.cyberciti.biz/tips/howto-limit-linux-syn-attacks.html">http://www.cyberciti.biz/tips/howto-limit-linux-syn-attacks.html</a></li>
</ul>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'stderr-cz-blog';
    var disqus_title = 'Útočí na mě z...';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Komentáře pouze s JavaScriptem.</noscript>
            </div>
        </div>
    </div>

    <div class="footer">
        <p class="text-center" style="color: #666;">2009 ~ 2014</p>
    </div>
    </body>
</html>