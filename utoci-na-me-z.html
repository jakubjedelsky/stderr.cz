<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Útočí na mě z... @ stderr</title>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" href="favicon.ico" />

        <link href="https://stderr.cz/theme/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://stderr.cz/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="https://stderr.cz/theme/css/pygment.css" rel="stylesheet">
        <link href="https://stderr.cz/theme/css/mystyle.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,700,300&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <meta name="twitter:card" value="summary" />
    <meta name="twitter:creator" content="@" />
    <meta name="twitter:title" content="Útočí na mě z..." />
    <meta name="twitter:description" content="Čas Vánoční je čas pohody, klidu a míru. To platí jen do určité chvíle. Třeba dokud na váš server nezačnou útočit z ... Číny. Jedná se o celkem aktuální aférku, o které se (pěkně blbě, takže to..." />

        <link rel="alternate" type="application/atom+xml" href="https://stderr.cz/feed.atom.xml" title="stderr ATOM/RSS Feed" />
        <!-- Minified Cookie Consent served from a CDN -->
        <script src="https://stderr.cz/theme/js/cookieconsent.js"></script>
        <!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
        <script type="text/javascript">
            window.cookieconsent_options = {"message":"Hej, psst! Přidej se na temnou stranu, mám tu koláčky (cookies)","dismiss":"Ano!","learnMore":"Více info","link":null,"theme":"light-floating"};
        </script>
    </head>

    <body>
    <div class="container">
        <div class="row">
            <div class="span9 offset2">
                <ul class="breadcrumb menu">
                    <li><a href="https://stderr.cz">Úvod</a></li>
                    <li><a href="https://stderr.cz/o-mne">O mně</a></li>
                    <li><a href="https://stderr.cz/archives">Archiv</a></li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="span2 text-center">
                <div class="hero-unit">
                    <div id="avatar"></div>
                    <h1><a href="https://stderr.cz">stderr</a></h1>
                    <p>Jakub Jedelský</p>
                </div>
                <div class="metadata">
                    <ul class="social">
                            <li><a href="https://www.linkedin.com/in/jedelsky" target="_blank"><img src="https://stderr.cz/theme/social/linkedin-24.png" width="24" height="24" title="Linkedin" class="si-linkedin" /></a></li>
                            <li><a href="https://github.com/jakubjedelsky" target="_blank"><img src="https://stderr.cz/theme/social/github-24.png" width="24" height="24" title="Github" class="si-github" /></a></li>
                            <li><a href="https://stderr.cz/feed.atom.xml" target="_blank"><img src="https://stderr.cz/theme/social/rss-24.png" width="24" height="24" title="Rss" class="si-rss" /></a></li>
                    </ul>
                </div>
            </div>
            <div class="span9">
<h2>Útočí na mě z...</h2>
<time datetime=2011-12-19T16:00:00+01:00>19. 12. 2011</time><div class="article">
<p>Čas Vánoční je čas pohody, klidu a míru. To platí jen do určité chvíle.
Třeba dokud na váš server nezačnou útočit z ... Číny.</p>
<p>Jedná se o celkem aktuální aférku, o které se (pěkně blbě, takže to ani
nečtěte) rozepsala <a href="http://www.lupa.cz/clanky/tisice-tuzemskych-e-shopu-melo-vypadky-muze-za-to-masivni-ddos-utok/">Lupa.cz</a>, nějaké detaily o probíhajících útocích
jsou na <a href="http://www.rcnoviny.cz/2011/12/ddos-tok-na-strnky-s-rc-modely/">rcnoviny.cz</a>.  </p>
<p>Ochrana proti takovému DDOS útoku není žádná sranda a jako admin
serveru máte jen omezené pole působnosti. Dokud útočníci nezahltí linku
(pak to řešte se svým ISP) a data k vám tak ještě putují, máte jen pár
možností, jak se těch nevyžádaných zbavit:</p>
<ul>
<li>
<p><strong>Omezení počtu současných připojení:</strong> je elegantní řešení. Pokud
    je ale botnet velký, stačí útočníkovi pouze omezený počet spojení a
    stejně vás položí. Naopak můžete omezit uživatele, kteří jsou za
    velkým NATem. Zkusit to ale preventivně můžete:</p>
<div class="highlight"><pre><span></span><code># zablokování portu 80 (webserver) nad 20 současných připojení
iptables -A INPUT -p TCP --syn --dport 80 -m connlimit --connlimit-above 20 -j REJECT
</code></pre></div>

</li>
<li>
<p><strong>Omezení připojení za časový úsek:</strong> má podobné omezení, jako výše
    uvedené.</p>
<div class="highlight"><pre><span></span><code>#<span class="w"> </span><span class="nv">zablokov</span>á<span class="nv">n</span>í<span class="w"> </span><span class="nv">nov</span>ý<span class="nv">ch</span><span class="w"> </span><span class="nv">TCP</span><span class="w"> </span><span class="nv">spojen</span>í<span class="w"></span>
<span class="nv">iptables</span><span class="w"> </span><span class="o">-</span><span class="nv">A</span><span class="w"> </span><span class="nv">INPUT</span><span class="w"> </span><span class="o">-</span><span class="nv">p</span><span class="w"> </span><span class="nv">tcp</span><span class="w"> </span><span class="o">--</span><span class="nv">syn</span><span class="w"> </span><span class="o">-</span><span class="nv">m</span><span class="w"> </span><span class="nv">limit</span><span class="w"> </span><span class="o">--</span><span class="nv">limit</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="nv">s</span><span class="w"> </span><span class="o">--</span><span class="nv">limit</span><span class="o">-</span><span class="nv">burst</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">-</span><span class="nv">j</span><span class="w"> </span><span class="k">RETURN</span><span class="w"></span>
</code></pre></div>

</li>
<li>
<p><strong>Omezení přístupu z konkrétní země:</strong> je dobré v případě, že na
    server útočí právě botnet, který je jen (nebo alespoň z podstatné
    části) v jedné konkrétní zemi a zároveň máte to štěstí, že s ní
    nemusíte komunikovat. Veškeré subnety rozdělené podle zemí najdete
    na webu <a href="http://www.ipdeny.com/ipblocks/">ipdeny.com</a>. Pro omezení příchozích spojení z Číny proto
    provedeme:</p>
<div class="highlight"><pre><span></span><code><span class="nt">wget</span><span class="w"> </span><span class="nt">http</span><span class="o">://</span><span class="nt">www</span><span class="p">.</span><span class="nc">ipdeny</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">ipblocks</span><span class="o">/</span><span class="nt">data</span><span class="o">/</span><span class="nt">countries</span><span class="o">/</span><span class="nt">cn</span><span class="p">.</span><span class="nc">zone</span><span class="w"></span>
<span class="nt">while</span><span class="w"> </span><span class="nt">read</span><span class="w"> </span><span class="nt">SUBNET</span><span class="w"> </span><span class="o">;</span><span class="w"> </span><span class="nt">do</span><span class="w"> </span><span class="nt">iptables</span><span class="w"> </span><span class="nt">-I</span><span class="w"> </span><span class="nt">INPUT</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="o">$</span><span class="nt">SUBNET</span><span class="w"> </span><span class="nt">-j</span><span class="w"> </span><span class="nt">REJECT</span><span class="w"> </span><span class="o">;</span><span class="w"> </span><span class="nt">done</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nt">cn</span><span class="p">.</span><span class="nc">zone</span><span class="w"></span>
</code></pre></div>

</li>
</ul>
<p>Žádné z výše popsaných řešení není úplně nejlepší, ale může pomoci při
první obraně systému. Další bezpečnostní otázky řešte s dokumentací
systému, manuálem k <code>iptables</code> a v neposlední řadě se svým ISP, který za
tučnou úplatu určitě rád pomůže.</p>
<p>Máte nějaké další tipy, jak útokům předejít? Podělte se..</p>
<p><strong>Zajímavé zdroje:</strong></p>
<ul>
<li><a href="http://cs.wikipedia.org/wiki/Botnet">http://cs.wikipedia.org/wiki/Botnet</a></li>
<li><a href="http://www.ipdeny.com/ipblocks">http://www.ipdeny.com/ipblocks</a></li>
<li><a href="http://www.cyberciti.biz/faq/iptables-connection-limits-howto/">http://www.cyberciti.biz/faq/iptables-connection-limits-howto/</a></li>
<li><a href="http://www.cyberciti.biz/tips/howto-limit-linux-syn-attacks.html">http://www.cyberciti.biz/tips/howto-limit-linux-syn-attacks.html</a></li>
</ul>
</div>
            </div>
        </div>
    </div>

    <div class="footer">
	<p class="text-center" style="color: #666;">vzniká od r. 2009</p>
    </div>
    </body>
</html>