<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Docker: jak jsme se seznámili @ stderr</title>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" href="favicon.ico" />

        <link href="https://stderr.cz/theme/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://stderr.cz/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="https://stderr.cz/theme/css/pygment.css" rel="stylesheet">
        <link href="https://stderr.cz/theme/css/mystyle.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,700,300&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <meta name="twitter:card" value="summary" />
    <meta name="twitter:creator" content="@kubiis" />
    <meta name="twitter:title" content="Docker: jak jsme se seznámili" />
    <meta name="twitter:description" content="Dění kolem lehkých linuxových kontejnerů jde spíše kolem mě. Až na Docker - čím déle jej sleduju, tím víc se mi líbí. A konečně jsem se dopracoval i k tomu si s ním trošku pohrát. Chvilka ..." />

        <link rel="alternate" type="application/atom+xml" href="https://stderr.cz/feed.atom.xml" title="stderr ATOM/RSS Feed" />
        <!-- Minified Cookie Consent served from a CDN -->
        <script src="https://stderr.cz/theme/js/cookieconsent.js"></script>
        <!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
        <script type="text/javascript">
            window.cookieconsent_options = {"message":"Hej, psst! Přidej se na temnou stranu, mám tu koláčky (cookies)","dismiss":"Ano!","learnMore":"Více info","link":null,"theme":"light-floating"};
        </script>
    </head>

    <body>
    <div class="container">
        <div class="row">
            <div class="span9 offset2">
                <ul class="breadcrumb menu">
                    <li><a href="https://stderr.cz/o-autorovi">O autorovi</a></li>
                    <li><a href="https://stderr.cz/archives">Archiv</a></li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="span2 text-center">
                <div class="hero-unit">
                    <div id="avatar"></div>
                    <h1><a href="https://stderr.cz">stderr</a></h1>
                    <p>Jakub Jedelský</p>
                </div>
                <div class="metadata">
                    <ul class="social">
                            <li><a href="https://www.linkedin.com/in/jedelsky" target="_blank"><img src="https://stderr.cz/theme/social/linkedin-32.png" title="Linkedin" class="si-linkedin" /></a></li>
                            <li><a href="https://stderr.cz/feed.atom.xml" target="_blank"><img src="https://stderr.cz/theme/social/rss-32.png" title="Rss" class="si-rss" /></a></li>
                            <li><a href="https://github.com/jakubjedelsky" target="_blank"><img src="https://stderr.cz/theme/social/github-32.png" title="Github" class="si-github" /></a></li>
                            <li><a href="https://twitter.com/kubiis" target="_blank"><img src="https://stderr.cz/theme/social/twitter-32.png" title="Twitter" class="si-twitter" /></a></li>
                    </ul>
                </div>
            </div>
            <div class="span9">
<h2>Docker: jak jsme se seznámili</h2>
<time datetime=2014-03-11T00:00:00+01:00>11. 03. 2014</time><div class="flattr">
    <script id='flattrbtn'>
    (function(i) {
        var f,s=document.getElementById(i);
        f=document.createElement('iframe');
        f.src='//api.flattr.com/button/view/?uid=stderr&button=compact&url='+encodeURIComponent(document.URL)+'&title=Docker: jak jsme se seznámili';
        f.title='Flattr';
        f.height=20;
        f.width=110;
        f.style.borderWidth=0;
        s.parentNode.insertBefore(f,s);
        })
    ('flattrbtn');
    </script>
</div>
<div class="article">
<p>Dění kolem lehkých linuxových kontejnerů jde spíše kolem mě. Až na <a href="https://www.docker.io/">Docker</a> - čím déle jej sleduju, tím víc se mi líbí. A konečně jsem se dopracoval i k tomu si s ním trošku pohrát.</p>
<p><center>
<img alt="Docker logo" src="https://www.docker.io/static/img/docker-top-logo.png" />
</center></p>
<p><em>Chvilka nezajímavého povídání:</em> Potřeboval jsem testovat a upravovat SQL dotazy nad MySQL. Už jsem vyrostl z toho, že si všechno nainstaluju do svého systému a pak nevím, co mi kde běží - snažím se jej naopak udržovat tak nějak v čistotě. Taky se mi s daty nechtělo pracovat na vzdáleném serveru - třeba ve vlaku je připojení dost mizerný. A v neposlední řadě se mi nechtělo kvůli MySQL serveru rozcházet KVM virtualizaci. Takže ideální čas pro Docker. <em>Konec nezajímavého povídání. Teda jak pro koho...</em></p>
<p>Znám pouze základy, takže tu nečekejte připravený Dockerfile (to třeba později, hehe), ale jen "tupý" postup, jak si rozběhnout jednoduchý MySQL server. Zároveň jsem dost línej rozepisovat, co jednotlivé příkazy přesně znamenají. Naštěstí u každého můžete použít <code>--help</code> nebo nakouknout do <a href="http://docs.docker.io/en/latest/reference/commandline/">dokumentace</a>.</p>
<p>Vše začíná stažením obrazu (image) systému, který chcete použít. Já vyrůstal s rpm, takže CentOS byla jasná volba:</p>
<div class="highlight"><pre><span></span>$ docker pull centos
</pre></div>


<p>Zkusíme kontejner nastartovat a hned se přepnout do příkazové řádky:</p>
<div class="highlight"><pre><span></span>$ docker run -t -i centos /bin/bash
bash-4.1#
</pre></div>


<p>Systém si zaktualizuju, nainstaluju balíčky, které potřebuju ...</p>
<div class="highlight"><pre><span></span>bash-4.1# yum -y update
bash-4.1# yum -y install mysql mysql-server
</pre></div>


<p>... a zkusím pustit MySQL server (což mi skončilo chybou).</p>
<div class="highlight"><pre><span></span>bash-4.1# service mysqld start
/etc/init.d/mysqld: line 23: /etc/sysconfig/network: No such file or directory
</pre></div>


<p>Tento soubor se načítá jen pro dodatečné funkce; init skript uspokojíme i prázným souborem. Služba pak naběhne jak má:</p>
<div class="highlight"><pre><span></span>bash-4.1# touch /etc/sysconfig/network
bash-4.1# service mysqld start
Initializing MySQL database: ...
(...)
Starting mysqld: [  OK  ]
</pre></div>


<p>Funguje! Jen po odhlášení z kontejneru zjistíte, že nic neběží a že i vytvoření network souboru bylo zbytečné.</p>
<p>Abych si upravený obraz mohl spustit a připojit se na něj, je potřeba změny commitnout (omlouvám se za to cizí slovo, ale nějak mě nenapadá český ekvivalent). Docker pracuje s otisky podobně jako git (odtud ten commit) - nazývá je jednoduše ID. Poslední změněný obraz ukáže příkaz ps:</p>
<div class="highlight"><pre><span></span>$ docker ps -l
CONTAINER ID   IMAGE        COMMAND     CREATED         STATUS   PORTS   NAMES
e5055fbceaec   centos:6.4   /bin/bash   9 minutes ago   Exit 0           cocky_brown
</pre></div>


<p>A o commit se postará příkaz ... wait for it ... commit:</p>
<div class="highlight"><pre><span></span>$ docker commit e5055fbceaec centos/mysql
</pre></div>


<p>Tímto jsme řekli, že změny, které jsou v otisku <code>e5055fbceaec</code> chceme uložit pod <code>centos/mysql</code>.</p>
<p>Teď už zbývá jen MySQL v kontejneru spustit a přesměrovat si porty:</p>
<div class="highlight"><pre><span></span>docker run -d -p :3306:3306 centos/mysql /usr/bin/mysqld_safe
</pre></div>


<p>A to je vše. Teď se jen musíme ze systému připojit ...</p>
<div class="highlight"><pre><span></span># mysql -u root -h 0.0.0.0
ERROR 1130 (HY000): Host &#39;172.17.42.1&#39; is not allowed to connect to this MySQL server
</pre></div>


<p>... a zjistíme, že to vlastně úplně nejde. Proč? To nechám na pozorném čtenáři, případně do dalšího článku.</p>
<p>Závěrem snad jen - běžící kontejnery vypíše příkaz <code>ps</code> a zastaví <code>stop</code>:</p>
<div class="highlight"><pre><span></span>$ docker ps
CONTAINER ID        IMAGE                 COMMAND                CREATED              STATUS              PORTS                    NAMES
beae68f2b5a3        centos/mysql:latest   /usr/bin/mysqld_safe   About a minute ago   Up About a minute   0.0.0.0:3306-&gt;3306/tcp   focused_nobel
$ docker stop beae68f2b5a3
</pre></div>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'stderr-cz-blog';
    var disqus_title = 'Docker: jak jsme se seznámili';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Komentáře pouze s JavaScriptem.</noscript>
            </div>
        </div>
    </div>

    <div class="footer">
	<p class="text-center" style="color: #666;">vzniká od r. 2009</p>
    </div>
    </body>
</html>