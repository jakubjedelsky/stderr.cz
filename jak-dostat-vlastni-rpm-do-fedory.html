<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Jak dostat vlastní RPM do Fedory @ stderr</title>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" href="favicon.ico" />

        <link href="http://stderr.cz/theme/css/bootstrap.min.css" rel="stylesheet">
        <link href="http://stderr.cz/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="http://stderr.cz/theme/css/pygment.css" rel="stylesheet">
        <link href="http://stderr.cz/theme/css/mystyle.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,700,300&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <meta name="twitter:card" value="summary" />
    <meta name="twitter:creator" content="@kubiis" />
    <meta name="twitter:title" content="Jak dostat vlastní RPM do Fedory" />
    <meta name="twitter:description" content="TL;DR: Toto není návod na sestavení RPM. Jen jsem si potřeboval utříbit a sepsat postup pro doručení již připraveného balíčku do repozitářů Fedory a EPELu. Ani nechci zabíhat do detailu - většinou ..." />

        <link rel="alternate" type="application/atom+xml" href="http://stderr.cz/feed.atom.xml" title="stderr ATOM/RSS Feed" />
        <!-- Minified Cookie Consent served from a CDN -->
        <script src="http://stderr.cz/theme/js/cookieconsent.js"></script>
        <!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
        <script type="text/javascript">
            window.cookieconsent_options = {"message":"Hej, psst! Přidej se na temnou stranu, mám tu koláčky (cookies)","dismiss":"Ano!","learnMore":"Více info","link":null,"theme":"light-floating"};
        </script>
    </head>

    <body>
    <div class="container">
        <div class="row">
            <div class="span9 offset2">
                <ul class="breadcrumb menu">
                    <li><a href="http://stderr.cz/o-autorovi">O autorovi</a></li>
                    <li><a href="http://stderr.cz/archives">Archiv</a></li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="span2 text-center">
                <div class="hero-unit">
                    <div id="avatar"></div>
                    <h1><a href="http://stderr.cz">stderr</a></h1>
                    <p>Jakub Jedelský</p>
                </div>
                <div class="metadata">
                    <ul class="social">
                            <li><a href="https://stderr.cz/feed.atom.xml" target="_blank"><img src="http://stderr.cz/theme/social/rss-32.png" title="Rss" class="si-rss" /></a></li>
                            <li><a href="https://www.linkedin.com/in/jedelsky" target="_blank"><img src="http://stderr.cz/theme/social/linkedin-32.png" title="Linkedin" class="si-linkedin" /></a></li>
                            <li><a href="https://github.com/jakubjedelsky" target="_blank"><img src="http://stderr.cz/theme/social/github-32.png" title="Github" class="si-github" /></a></li>
                            <li><a href="https://twitter.com/kubiis" target="_blank"><img src="http://stderr.cz/theme/social/twitter-32.png" title="Twitter" class="si-twitter" /></a></li>
                    </ul>
                </div>
            </div>
            <div class="span9">
<h2>Jak dostat vlastní RPM do Fedory</h2>
<time datetime=2014-04-04T00:00:00+02:00>04. 04. 2014</time><div class="flattr">
    <script id='flattrbtn'>
    (function(i) {
        var f,s=document.getElementById(i);
        f=document.createElement('iframe');
        f.src='//api.flattr.com/button/view/?uid=stderr&button=compact&url='+encodeURIComponent(document.URL)+'&title=Jak dostat vlastní RPM do Fedory';
        f.title='Flattr';
        f.height=20;
        f.width=110;
        f.style.borderWidth=0;
        s.parentNode.insertBefore(f,s);
        })
    ('flattrbtn');
    </script>
</div>
<div class="article">
<p><em>TL;DR:</em> Toto není návod na sestavení RPM. Jen jsem si potřeboval utříbit a sepsat postup pro doručení již připraveného balíčku do repozitářů Fedory a EPELu. Ani nechci zabíhat do detailu - většinou odkazuji na příslušnou <a href="http://fedoraproject.org/wiki/">wiki</a> (ale často jsem se neudržel).</p>
<p>Postup jsem popsal pro balíček <code>vertica-python</code>, který si tuto cestu už absolvoval. Hned na začátek doporučuji nastavit filtr e-mailu - do gmailu mi naskákalo celkem kolem 30 zpráv ve 13 vláknech.</p>
<h3>Všechno začíná (a končí) v bugzille</h3>
<p>Každý nový balíček se musí pěkně <a href="https://fedoraproject.org/wiki/Packaging:NamingGuidelines">jmenovat</a> a splnit <a href="https://fedoraproject.org/wiki/Packaging:ReviewGuidelines">pár jednoduchých podmínek</a>, aby prošel kontrolou od některého z jiných vývojářů. Ke komunikaci slouží ticket typu <a href="https://bugzilla.redhat.com/bugzilla/enter_bug.cgi?product=Fedora&amp;format=fedora-review">Review Request</a>, kam kromě základních informací pošlete odkaz své SPEC a SRPM soubory. Pokud jde o váš úplně nejprvnější balík, je potřeba si sehnat svého <a href="https://fedoraproject.org/wiki/How_to_get_sponsored_into_the_packager_group">sponzora</a>, který se za nováčka "zaručí" a bude mu případně pomáhat. Potom, co vám ostatní najdou spoustu chyb, vy je úspěšně opravíte (nebo obhájíte) a někdo nastaví flag <code>fedora-review</code> na <code>+</code>, zažádáme o nový repozitář.</p>
<p>Žádost o repozitář, ze kterého pak probíhá vlastní sestavení balíku, jde opět formou komentáře do Review Request ticketu. Zároveň s tím změníme flag <code>fedora-csv</code> na <code>?</code> (aby si nás admini všimli). Komentář vypadá nějak takto, vzor je opět na <a href="http://fedoraproject.org/wiki/Package_SCM_admin_requests">wiki</a>:</p>
<div class="highlight"><pre><span></span>New Package SCM Request
=======================
Package Name: vertica-python
Short description: A native python adapter for the Vertica database
Owners: kubo
Branches: f19 f20 el6 epel7
</pre></div>


<p>K tomu snad jedinou poznámku - větev <code>master</code> (pro <code>rawhide</code>) dostanete automaticky.</p>
<p>Do pár hodin pak máte odpověď od některého z adminů, že je repozitář připravený, flag <code>fedora-csv</code> se změní na <code>+</code>.</p>
<h3>Repozitář, sestavení a zveřejnění</h3>
<p>Zdrojové kódy se SPEC souborem a případnými patchi (nebo patchemi, patchema? Pačema?) se ukládají do <a href="http://pkgs.fedoraproject.org">veřejně přístupného</a> <code>git</code>ovského repozitáře. Fedora nabízí pro práci (nejen) s tímto repozitářem nástroj <code>fedpkg</code>, ale obejdete se i bez něj. Ale ne zde v dalších krocích.</p>
<p>Nejprve si repozitář naklonujeme k sobě...</p>
<div class="highlight"><pre><span></span>fedpkg clone vertica-python
</pre></div>


<p>...a naimportujeme schválený SRPM balík</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> vertica-python
fedpkg import /var/lib/mock/fedora-rawhide-x86_64/result/vertica-python-0.2.0-4.fc21.src.rpm
</pre></div>


<p>Import na nás vyrukuje s logem, který zkontrolujeme a změny <a href="http://fedoraproject.org/wiki/Join_the_package_collection_maintainers#Import.2C_Commit.2Cand_Build_Your_Package">commitneme</a>. Vše pošleme do vzdáleného repozitáře a spustíme build na <a href="http://koji.fedoraproject.org">koji</a>:</p>
<div class="highlight"><pre><span></span><span class="c1"># hele ho, git!</span>
git commit -m <span class="s2">&quot;Initial import (#1080669)&quot;</span>
git push
fedpkg build
</pre></div>


<p>V tuto chvíli se sestavuje balíček pro <code>rawhide</code>. Můžeme zatím vesele pokračovat s dalšími větvemi (od nejvyšší verze dolů):</p>
<div class="highlight"><pre><span></span>fedpkg switch-branch f20
git merge master
git push
fedpkg build
fedpkg switch-branch f19
...
..
.
</pre></div>


<p>V <a href="http://koji.fedoraproject.org">koji</a> už teď máme uložená sestavení, která (předpokládám) prošla - můžeme tak začít balíček ládovat do repozitářů. Toto probíhá pomocí nástroje <a href="https://admin.fedoraproject.org/updates">Bodhi</a>. Pro všechny větve (kromě <code>masteru</code> a aktuálně <code>epel7</code>, který je v betě) pošleme požadavek na zařazení do testovacích repozitářů (udělat to lze i přes webové rozhraní Bodhi):</p>
<div class="highlight"><pre><span></span>git checkout f20 <span class="c1"># nebo fedpkg switch-branch f20</span>
fedpkg update
</pre></div>


<p>Update bude chtít vyplnit pár informací. Nás zajímají řádky:</p>
<ul>
<li><code>type=</code> (jde o opravu chyby, vylepšení nebo nový balíček?)</li>
<li><code>request=</code> (žádáte o testovací nebo stable repozitář?)</li>
<li><code>bugs=</code> (ID v Bugzille)</li>
<li><code>notes=</code> (u nového balíčku krátký popis).</li>
</ul>
<p>Pro <code>vertica-python</code> to vypadalo takto:</p>
<div class="highlight"><pre><span></span><span class="o">[</span> vertica-python-0.2.0-4.fc20 <span class="o">]</span>

<span class="c1"># bugfix, security, enhancement, newpackage (required)</span>
<span class="nv">type</span><span class="o">=</span>newpackage

<span class="c1"># testing, stable</span>
<span class="nv">request</span><span class="o">=</span>testing

<span class="c1"># Bug numbers: 1234,9876</span>
<span class="nv">bugs</span><span class="o">=</span>1080669

<span class="c1"># Changelog:</span>
<span class="c1"># - remove buildrood tag</span>
<span class="c1"># - edit dateutil patch for el6 </span>
<span class="c1">#</span>
<span class="c1"># Here is where you give an explanation of your update. </span>
<span class="nv">notes</span><span class="o">=</span>A native python adapter <span class="k">for</span> the Vertica database

<span class="c1"># Enable request automation based on the stable/unstable karma thresholds</span>
<span class="nv">autokarma</span><span class="o">=</span>True
<span class="nv">stable_karma</span><span class="o">=</span>3
<span class="nv">unstable_karma</span><span class="o">=</span>-3

<span class="c1"># Automatically close bugs when this marked as stable</span>
<span class="nv">close_bugs</span><span class="o">=</span>True

<span class="c1"># Suggest that users restart after update</span>
<span class="nv">suggest_reboot</span><span class="o">=</span>False
</pre></div>


<p>Po uložení se žádost zpracuje a dostaneme potvrzení:</p>
<div class="highlight"><pre><span></span>Creating a new update for  vertica-python-0.2.0-4.fc20 
Update successfully created
================================================================================
     vertica-python-0.2.0-4.fc20
================================================================================
    Release: Fedora 20
     Status: pending
       Type: newpackage
      Karma: 0
    Request: testing
       Bugs: 1080669 - Review Request: vertica-python - A native Python adapter
           : for the Vertica database
      Notes: A native Python adapter for the Vertica database
  Submitter: kubo
  Submitted: 2014-03-31 13:35:36
   Comments: bodhi - 2014-03-31 13:35:49 (karma 0)
             This update has been submitted for testing by kubo.

  https://admin.fedoraproject.org/updates/vertica-python-0.2.0-4.fc20
</pre></div>


<p>Na posledním řádku je vidět i odkaz, kde můžete sledovat, jak se požadavek zpracovává a kudy rpm cestuje. Cesta do stabilních repozitářů Fedory trvá týden, pro EPEL jsou to hned týdny dva. Mezitím vám jiní uživatelé (QA) můžou dávat veselý a smutný smajlíky. Za tři veselý se do stabilního repozitáře dostanete hned, dobrý ne?</p>
<h3>Končíme na Bugzille</h3>
<p>Kecám. Pokud vše projde jak má a balíček se prokouše až do stabilních repozitářů, pak Bodhli za vás ticket automaticky zavře. Takže se už o nic nemusíte starat.</p>
<p>A na závěr nezbývá než popřát všem RPM balíkům šťastnou cestu.</p>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'stderr-cz-blog';
    var disqus_title = 'Jak dostat vlastní RPM do Fedory';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Komentáře pouze s JavaScriptem.</noscript>
            </div>
        </div>
    </div>

    <div class="footer">
	<p class="text-center" style="color: #666;">vzniká od r. 2009</p>
    </div>
    </body>
</html>